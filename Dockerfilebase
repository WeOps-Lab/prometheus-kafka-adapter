FROM docker-bkrepo.cwoa.net/ce1b09/weops-docker/weops-kafka-adapter:base as build
WORKDIR /src/prometheus-kafka-adapter

COPY go.mod go.sum vendor *.go ./

ADD . /src/prometheus-kafka-adapter

RUN apk add gcc musl-dev
RUN go build -ldflags='-w -s -extldflags "-static"' -tags musl,static,netgo -mod=vendor -o /prometheus-kafka-adapter

FROM alpine:3.16

COPY schemas/metric.avsc /schemas/metric.avsc
COPY metrics.yaml /metrics.yaml
COPY --from=build /prometheus-kafka-adapter /

CMD /prometheus-kafka-adapter
